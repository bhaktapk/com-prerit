<?xml version="1.0"?>
<project name="Deploy"
         default="deploy"
         xmlns="http://nant.sf.net/release/0.86-beta1/nant.xsd">

  <!-- PUBLIC TARGETS -->

  <target name="deploy">
    <call target="take-website-offline" />
    <call target="delete-previous-deployment" />
    <call target="copy-new-deployment" />
    <call target="set-connection-strings" />
    <call target="bring-website-online" />
  </target>



  <!-- PRIVATE TARGETS -->

  <target name="bring-website-online">
    <delete file="${dir.deploy}\app_offline.htm" />
  </target>

  <target name="copy-new-deployment">
    <unzip zipfile="${dir.packages}\${package.name.com-prerit-web-ui}"
           todir="${dir.deploy}" />
  </target>

  <target name="delete-previous-deployment">
    <delete>
      <fileset basedir="${dir.deploy}">
        <include name="**" />
        <exclude name="app_offline.htm" />
      </fileset>
    </delete>
  </target>

  <target name="set-connection-strings">
    <copy file="${dir.deploy}\connection_strings.config.template"
          tofile="${dir.deploy}\connection_strings.config"
          overwrite="true">

      <filterchain>
        <replacetokens>
          <token key="COM-PRERIT-DB"
                 value="${database.com-prerit.conn-string}" />
        </replacetokens>
      </filterchain>
    </copy>

    <delete file="${dir.deploy}\connection_strings.config.template" />
  </target>

  <target name="take-website-offline">
    <if test="${file::exists(dir.deploy + '\app_offline.aspx')}">
      <move file="${dir.deploy}\app_offline.aspx"
            tofile="${dir.deploy}\app_offline.htm" />
    </if>
  </target>
</project>
